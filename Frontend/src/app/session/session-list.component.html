<div *ngIf="componentState == 0">
<div class="bigScreen">
  <h2>Explore</h2>
  <hr>
  <form>
    <table>
      <tr>
        <th>
          <mat-form-field color="primary">
          <mat-label color="primary">System</mat-label>
          <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterSystem" 
          name="filterSystem" [matAutocomplete]="auto" [formControl]="myControl">
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let system of systemsFiltered | async" [value]="system.name">
                  {{system.name}}
              </mat-option>
            </mat-autocomplete>  
        </mat-form-field> 
        </th>
        <th> 
          <button mat-flat-button color="accent" type=button (click)="onAddSystemFilterClicked()">Add filter</button> 
        </th>
        <th>
          <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current system filters</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="fitlersDisplayedSystem" name="filterSystemCurrent" disabled>
          </mat-form-field> 
        </th>
        <th> 
          <button mat-flat-button color="accent" type="button" (click)="onClearSystemFiltersClicked()">Clear filters</button> 
        </th>
    </tr>
    <tr>
      <th>
        <mat-form-field color="primary">
        <mat-label color="primary">Gm</mat-label>
        <input color="primary" matInput placeholder="" [(ngModel)]="filterGm" name="filterGm">
        </mat-form-field> 
      </th>
      <th> 
        <button mat-flat-button color="accent" type="button" (click)="onAddGmFilterClicked()">Add filter</button> 
      </th>
        <th>
          <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current GM filters</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="filtersDisplayedGm" name="filterGmCurrent" disabled>
          </mat-form-field> 
        </th>
        <th> 
          <button mat-flat-button color="accent" type="button" (click)="onClearGmFiltersClicked()">Clear filters</button> 
        </th>
    </tr>
    <tr>
      <th>
        <mat-form-field color="primary">
          <mat-label color="primary">Tags</mat-label>
          <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterTag" name="filterTag">
        </mat-form-field> 
      </th>
      <th>
        <button mat-flat-button color="accent" type="button" (click)="onAddTagFilterClicked()">Add filter</button> 
      </th>
      <th>
        <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current tags</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="filtersDisplayedTags" name="filterTagsCurrent" disabled>
        </mat-form-field> 
      </th>
      <th>
        <button mat-flat-button color="accent" type="button" (click)="onClearTagFiltersClicked()">Clear filters</button> 
      </th>
    </tr>
    <tr>
      <mat-form-field color="primary">
        <mat-label color="primary">Title</mat-label>
        <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterTitle" (change)="filterSessions()" name="filterTitle">
      </mat-form-field> 
    </tr>
  </table>
  </form>
</div>

<div class="smallScreen">
  <h2>Explore</h2>
  <hr>
  <form>
    <table>
      <tr>
        <th>
          <mat-form-field color="primary">
          <mat-label color="primary">System</mat-label>
                    <mat-label color="primary">System</mat-label>
          <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterSystem" 
          name="filterSystem" [matAutocomplete]="auto" [formControl]="myControl">
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let system of systemsFiltered | async" [value]="system.name">
                  {{system.name}}
              </mat-option>
            </mat-autocomplete>  
          </mat-form-field> 
        </th>
        <th class="tableButton"> 
          <button mat-flat-button color="accent" type=button (click)="onAddSystemFilterClicked()">Add filter</button> 
        </th>
        <th class="tableButton"> 
          <button mat-flat-button color="accent" type="button" (click)="onClearSystemFiltersClicked()">Clear filters</button> 
        </th>
      </tr>
      </table>
      <table>
      <tr>
        <th>
          <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current system filters</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="fitlersDisplayedSystem" name="filterSystemCurrent" disabled>
          </mat-form-field> 
        </th>
    </tr>
    </table>
    <table>
    <tr>
      <th>
        <mat-form-field color="primary">
        <mat-label color="primary">Gm</mat-label>
        <input color="primary" matInput placeholder="" [(ngModel)]="filterGm" name="filterGm">
        </mat-form-field> 
      </th>
      <th class="tableButton"> 
        <button mat-flat-button color="accent" type="button" (click)="onAddGmFilterClicked()">Add filter</button> 
      </th>
      <th class="tableButton"> 
        <button mat-flat-button color="accent" type="button" (click)="onClearGmFiltersClicked()">Clear filters</button> 
      </th>
      </tr>
    </table>
    <table>
      <tr>
        <th>
          <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current GM filters</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="filtersDisplayedGm" name="filterGmCurrent" disabled>
          </mat-form-field> 
        </th>
    </tr>
  </table>
  <table>
    <tr>
      <th>
        <mat-form-field color="primary">
          <mat-label color="primary">Tags</mat-label>
          <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterTag" name="filterSystem">
        </mat-form-field> 
      </th>
      <th class="tableButton">
        <button mat-flat-button color="accent" type="button" (click)="onAddTagFilterClicked()">Add filter</button> 
      </th>
      <th class="tableButton">
        <button mat-flat-button color="accent" type="button" (click)="onClearTagFiltersClicked()">Clear filters</button> 
      </th>
    </tr>
  </table>
  <table>
    <tr>
      <th>
        <mat-form-field class="currentFilters" color="primary">
          <mat-label color="primary">Current tags</mat-label>
          <input color="primary" matInput placeholder="" [(ngModel)]="filtersDisplayedTags" name="filterGmCurrent" disabled>
        </mat-form-field> 
      </th>
    </tr>
  </table>
  <table>
    <tr>
      <mat-form-field color="primary">
        <mat-label color="primary">Title</mat-label>
        <input type="text" color="primary" matInput placeholder="" [(ngModel)]="filterTitle" name="filterSystem">
      </mat-form-field> 
    </tr>
  </table>
  </form>
</div>

<div *ngIf="!anySessions">
  <mat-divider></mat-divider>
  No session matches selected filters : /
</div>

<table mat-table class="sessionList" [dataSource]="filteredSessions" *ngIf="anySessions">
  <ng-container matColumnDef="Gm">
    <th mat-header-cell *matHeaderCellDef > Gm </th>
    <td mat-cell *matCellDef="let session"> {{session.gm.name}} </td>
  </ng-container>
  <ng-container matColumnDef="System">
    <th mat-header-cell *matHeaderCellDef> System </th>
    <td mat-cell *matCellDef="let session"> {{session.system.name}} </td>
  </ng-container>
  <ng-container matColumnDef="Title">
    <th mat-header-cell *matHeaderCellDef> Title </th>
    <td mat-cell *matCellDef="let session"> {{session.title}} </td>
  </ng-container>
  <ng-container matColumnDef="Tags">
    <th mat-header-cell *matHeaderCellDef> Tags </th>
    <td mat-cell *matCellDef="let session"> {{session.tags}} </td>
  </ng-container>
  <ng-container matColumnDef="Players">
    <th mat-header-cell *matHeaderCellDef> Players </th>
    <td mat-cell *matCellDef="let session"> {{session.currentNumberOfPlayers}}/{{session.maxNumberOfPlayers}} </td>
  </ng-container>
  
  <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
  <tr class="regularRow" mat-row *matRowDef="let myRowData; columns: columnsToDisplay" (click)="displaySessionDetails(myRowData)"></tr>  
</table>
</div>

<div *ngIf="componentState==1">
  <h2>Session details</h2>
  <hr>
  <mat-card class="example-card">
    <mat-card-header>
      <img mat-card-avatar class="gmImage" src={{gmForSession.profilePicture}}>
      <mat-card-title>{{sessionRow.title}}</mat-card-title>
      <mat-card-subtitle>{{sessionRow.system.name}}</mat-card-subtitle>
      <mat-card-subtitle>{{gmForSession.name}}</mat-card-subtitle>
      <mat-card-subtitle><br></mat-card-subtitle>
    </mat-card-header>
    <br>
    <img mat-card-image src={{sessionPicture}}>
    <br>
    <mat-card-content>
      <p>
        <br>
        {{sessionRow.description}}
      </p>
    </mat-card-content>
    <mat-card-footer>
      <table>
        <tr class="justText">
          <th class="justText">
            Number of players
          </th>
          <th class="justText">
            {{sessionRow.currentNumberOfPlayers}}/{{sessionRow.maxNumberOfPlayers}}
          </th>
        </tr>
        <tr class="justText">
          <th class="justText">
            Email:
          </th>
          <th class="justText">
            {{gmForSession.email}}
          </th>
        </tr>
        <tr class="justText">
          <th class="justText">
            Discord:
          </th>
          <th class="justText">
            {{gmForSession.discord}}
          </th>
        </tr>
      </table>
    </mat-card-footer>
    <div *ngIf="user.role == 'Player'">
    <mat-card-actions>
      <button mat-flat-button color="accent" type="button" (click)="joinPlayer()">Join</button>
    </mat-card-actions>
    </div>
  </mat-card>
  <br>
  <h2>Players:</h2>
  <mat-divider></mat-divider>
  <br>
  <div *ngIf="playersForSession.length != 0">
    <table>
      <tbody>
      <tr *ngFor="let player of playersForSession">
        <td class="playerInfo">
          <img class="circle" src={{player.profilePicture}}>
        </td>
        <td class="playerInfo">
          <h3>{{player.name}}</h3>
        </td>
        <td class="playerInfo">
          <h3>{{player.email}}</h3>
        </td>
        <td class="playerInfo">
          <img class="discordIcon" src="assets\discordImage.png">
        </td>
        <td class="playerInfo">
          <h3>{{player.discord}}</h3>
        </td>
      </tr>
    </tbody>
    </table>
    </div>
<div *ngIf="playersForSession.length==0">
No player have joined this session yet. Maybe come back and check a little later ;)
</div>
</div>


<div *ngIf="componentState == 3">
  You have successfully joined the session.
  <br>
  <br>
  <mat-divider></mat-divider>
  <br>
  <button mat-flat-button color="primary" type="button" 
      (click)="onReturnClicked()">Return to exploring</button>
</div>

<div *ngIf="componentState == 4">
  Failed to join the session :c
  <br>
  Make sure you have a stable internet connection or try again later
  <br>
  <br>
  <mat-divider></mat-divider>
  <br>
  <button mat-flat-button color="primary" type="button" 
      (click)="onReturnClicked()">Return to exploring</button>
</div>